<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="cards.css" />
    <link rel="stylesheet" href="editor.css" />
    <link rel="stylesheet" href="whyiambetter.css">
    <link href="./assets/prism.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
  </head>

  <body>
    <script src="./assets/prism.js"></script>
    <div class="containers">
      <div class="left-container">
        
      </div>

      <div class="right-container">
        <nav class="nav">
          <span id="too__simple-huh">Too simple, huh ?</span>
          <ul class="nav__links-wrapper">
            <li class="nav__link">Why I'm better</li>
            <li class="nav__link">Works</li>
            <li class="nav__link">Contacts</li>
          </ul>

          <div class="menu-container">
            <div class="menu">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>

        </nav>
<!--         <div class="first-block"></div> -->

        <div class="story">
          <div id="because">
            <h1>B</h1>
            <h1>e</h1>
            <h1>c</h1>
            <h1>a</h1>
            <h1>u</h1>
            <h1>s</h1>
            <h1>e</h1>
          </div>
          <h2 class="great">
            I'm a great developer
          </h2>
          <p>Read More</p>
        </div>

        <div class="social-container">
          <li class="social">
            <ul>
              Facebook
            </ul>
            <ul>
              Instagram
            </ul>
            <ul>
              Twitter
            </ul>
          </li>
        </div>

      </div>
<!--    <div class="switch__parent">
          <div class="switch__lan switch__lan--js">JS</div>
          <div class="switch__lan switch__lan--py">PY</div>
          <div class="switch__lan switch__lan--c">C++</div>
        </div>
-->

      <div class="pre__highlight prompt">
        <h2 style="color:#fff;">Here's some prompt</h2>
        <pre>
          <code class="highlight language-powershell">
Given a string num that contains only digits and an integer target,
return all possibilities to insert the binary operators '+', '-', and/or '*'
between the digits of num so that the resultant expression evaluates to the target value.
Note that operands in the returned expressions should not contain leading zeros.
          </code>
        </pre>
      </div>

<!--       <h2 style="color: #fff;">Here's your solution.... welp</h2> -->
      <button class="prompt__try">Try</button>
      <div class="editor__wrapper">
        <textarea id="editing"
          oninput="update(this.value); sync_scroll(this);"
          onscroll="sync_scroll(this);"
          onkeydown="check_tab(this, event)"
          spellcheck="false"></textarea>

        <pre id="highlighting" aria-hidden="true">
          <code id="highlighting-content" class="code language-python"></code>
        </pre>
        <div>
          <button class="editor__button" onclick="sendCode()">Send Code</button>
        </div>
      </div>

      <div class="output__wrapper">
        <pre area-hidden="true">
          <code id="output__window" class="language-powershell"></code>
        </pre>
      </div>


      <div class="scroller__parent">
        <i class="arrow down" draggable="true"></i>
        <i class="arrow down" draggable="true"></i>
        <i class="arrow down" draggable="true"></i>
      </div>
    </div>

    <div class="beatanyone__container">

      <div class="scroller__parent scroller__parent--up">
        <i class="arrow up" draggable="true"></i>
        <i class="arrow up" draggable="true"></i>
        <i class="arrow up" draggable="true"></i>
      </div>

      <section class="beatanyone">
        <div>
          <div class="ag-courses_item">
            <a href="https://cssbattle.dev/" class="ag-courses-item_link">
              <div class="ag-courses-item_bg"></div>
              <div class="ag-courses-item_title">
                CSS Battles
              </div>
              <div></div>
              <div class="ag-courses-item_date-box">
                I'm going to beat them all in CSS battles
              </div>
            </a>
          </div>
        </div>
      </section>

      <section class="beatanyone beatanyone__right">
        <div>
          <div class="ag-courses_item">
            <a href="http://leetcode.com" rel="noopener" class="ag-courses-item_link">
              <div class="ag-courses-item_bg"></div>
              <div class="ag-courses-item_title">
                LeetCode Challenges
              </div>
              <div></div>
              <div class="ag-courses-item_date-box">
                I'll beat all of them in data structures and algorithms
              </div>
            </a>
          </div>
        </div>
      </section>

      <section class="beatanyone">
        <div>
            <div class="ag-courses_item">
              <a href="#" class="ag-courses-item_link">
                <div class="ag-courses-item_bg"></div>
                <div class="ag-courses-item_title">
                  JavaScript Knowledge
                </div>
                <div></div>
                <div class="ag-courses-item_date-box">
                  What is a generator function ? 
                  How is it used in combination with Promises to secure asynchronisity of JS
                </div>
                <div class="ag-courses-item_date">
                  generator function ?
                </div>
              </a>
            </div>
        </div>
      </section>

      <section class="beatanyone"></section>
    </div>
    <section id="works"></section>

    <section id="contacts"></section>

    <script type="text/javascript" defer>
      const tl = gsap.timeline();

       tl.from(".left-container", {
        duration: 1,
        width: "0",
        ease: "expo.out"
      })
      .from(".right-container", {
        duration: 2,
        width: "0",
        opacity: 0,
        ease: "expo.inOut"
      }) // start after 1.5 seconds delay
      .from(".down", {
        opacity: 0,
        duration: -1
      }, "-=2") // start after 2 seconds delay
      .from(".center-container", {
        duration: 2,
        width: "0",
        x: -20,
        ease: "expo.inOut"
      }, "-=2") // start after 3 seconds delay
      .from(".code__card", {
        duration: 2,
        width: "0",
        x: -20,
        opacity: 0,
        ease: "expo.inOut"
      }, "-=2") // start after 3 seconds delay
      .from(".code", {
        duration: 2,
        y: '0',
        ease: "expo.inOut"
      }, "-=2")
      .from(".switch__lan", {
        duration: 2,
        opacity: '0',
        ease: "power2.in"
      }, "-=2") 
      .from(".logo", {
        duration: 2,
        y: 20,
        opacity: 0,
        ease: "expo.inOut"
      }, "-=1.5") // start after 1.5 seconds delay
      .from(".info", {
        duration: 2,
        y: 50,
        opacity: 0,
        scale: 2.5,
        ease: "expo.inOut"
      }, "-=1.5") // start after 1.5 seconds delay
      .from(".story", {
        duration: 2,
        y: 20,
        opacity: 0,
        ease: "expo.inOut"
      }, "-=2.5") // start after 2.5 seconds delay
      .from(".great", {
        duration: 2,
        opacity: 0,
        ease: "expo.inOut"
      }, "-=3") // start after 3 seconds delay
      .from(".menu", {
        duration: 2,
        y: 20,
        opacity: 0,
        rotation: 90,
        ease: "expo.inOut"
      }, "-=3.5") // start after 3.5 seconds delay
      .from(".social ul", {
        duration: 2,
        opacity: 0,
        y: 20,
        ease: "expo.inOut",
        stagger: 0.1
      }, "-=3.8") // start after 3.8 seconds delay


      const editorButton = document.querySelector('.editor__button');

      const links = document.getElementsByClassName('nav__link');

      const tooSimple = document.getElementById('too__simple-huh');

      const tryButton = document.querySelector('.prompt__try');

      const leftContainer = document.querySelector('.left-contaienr');

      const rightContainer = document.querySelector('.right-container');

      for (const link of links) {
        link.addEventListener('mouseover', function handleEvent(event) {
            tooSimple.style.opacity = "1";
            tooSimple.style.transform = 'rotate(-15deg)';
        });
        link.addEventListener('mouseout', function handleEvent(event) {
            //tooSimple.textContent = "";
            tooSimple.style.opacity = "0";
        })
      }

      editorButton.addEventListener('mouseover', function handleEvent(event) {
        this.innerText = "Are you bloody sure ?";
      });

      editorButton.addEventListener('mouseout', function handleEvent(event) {
        this.innerText = "Send Code";
      });

      tryButton.addEventListener('click', function handleEvent(event) {

      });

      var t2 = gsap.timeline({ repeat: -1, repeatDelay: .5 });

      t2.from('.arrow', { y: -10, stagger: .2 });

      //t2.from('.prompt__try', { x: -10, ease: 'power2.inOut' })

      const arrowsDown = document.getElementsByClassName('arrow');

      const arrowsUp = document.getElementsByClassName('up');

      for(const arrow of arrowsDown) {
        arrow.addEventListener('dragstart', function (event) {
          console.log('draggin');
          tl.to('.containers', {
            duration: 1,
            y: "-100%",
            ease: "expo.out",
          })
           .to('.beatanyone__container', {
            duration: 1,
            y: "-100%",
            display: "block",
            opacity: 1,
            ease: "power2.out"
          }, ">"); 
        })
      }

      for(const arrow of arrowsUp) {
        arrow.addEventListener('dragstart', function (event) {
           tl.to('.beatanyone__container', {
            display: "none",
            duration: 1,
            delay: -1,
            ease: "none"
          }).
           to('.containers', {
            duration: 1,
            y: "0",
            ease: "none",
          })
        });
      }

      const wrongPrompts = [
        "Welp this ain't how it's working !",
        "Not a right answer",
        "Not that much of a seniour, huh ?"
      ];

      async function sendCode() {
        try {
          const textCode = document.getElementById('highlighting-content');

          const outputNode = document.getElementById('output__window');

          //if (!textCode.innerText.includes("def why_im_better_than_your_seniours()")) return;

          //textCode.innerText+="\n why_im_better_than_your_seniours()"

          //formData.append("");
          const request = await fetch("http://localhost:3000", {
             method: "POST", body: new URLSearchParams({
              'language': 'py',
              'code': textCode.innerText// + "\n\twhy_im_better_than_your_seniours()"
             }), headers: { 
              'Content-Type': 'application/x-www-form-urlencoded'
            }
          });

          const response = await request.json();

          outputNode.innerHTML = "";

          outputNode.innerText = String(response.output || response.error).trim();
          //console.log(response.output.split("True").join('').trim().split())

          const testsFailed = response.output.split("\n").some(item => item === 'False');

          if (!response.error && !testsFailed) {
            outputNode.innerText = "wow wow";
          }
          else if (!response.error && testsFailed) {
            outputNode.innerText = wrongPrompts[Math.floor(Math.random()*wrongPrompts.length)];;
          }

          Prism.highlightElement(outputNode);
          //console.log(response.json());
        } catch (error) {
          console.log(error);
        } 
      }

      let highlightText = document.getElementById('editing');

      highlightText.value = "def why_im_better_than_your_seniours(num:str, target:int):" + "\n\t" + "pass";

      update("def why_im_better_than_your_seniours(num:str, target:int):" + "\n\t" + "pass");

      function update(text) {
        let result_element = document.getElementById("highlighting-content");
        // Update code
        result_element.innerText = text;

        if(text[text.length-1] == "\n") { // If the last character is a newline character
          text += " "; // Add a placeholder space character to the final line 
        }

        result_element.innerHTML = text.replace(new RegExp("&", "g"), "&").replace(new RegExp("<", "g"), "<"); 
        // Syntax Highlight
        Prism.highlightElement(result_element);
      }

      function check_tab(element, event) {
        let code = element.value;
        if(event.key == "Tab") {
          /* Tab key pressed */
          event.preventDefault(); // stop normal
          let before_tab = code.slice(0, element.selectionStart); // text before tab
          let after_tab = code.slice(element.selectionEnd, element.value.length); // text after tab
          let cursor_pos = element.selectionEnd + 1; // where cursor moves after tab - moving forward by 1 char to after tab
          element.value = before_tab + "\t" + after_tab; // add tab char

          element.selectionStart = cursor_pos;
          element.selectionEnd = cursor_pos;
          update(element.value); // Update text to include indent
        }
      }

      function sync_scroll(element) {
        /* Scroll result to scroll coords of event - sync with textarea */
        let result_element = document.querySelector("#highlighting");
        // Get and set x and y
        result_element.scrollTop = element.scrollTop;
        result_element.scrollLeft = element.scrollLeft;
      }

    </script>
  </body>
</html>
